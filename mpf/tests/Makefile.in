# Makefile for mpf/tests for GNU MP

srcdir = .

CC = gcc

TEST_LIBS = ../../libgmp.a
INCLUDES = -I../../mpn -I$(srcdir)/../..
CFLAGS = -g -O

.c.o:
	$(CC) -c $(INCLUDES) $(CFLAGS) $(XCFLAGS) $<

TEST_SRCS = t-add.c t-sub.c t-conv.c t-sqrt.c t-muldiv.c t-dm2exp.c t-reuse.c \
  t-get_d.c ref.c
TEST_OBJS = t-add.o t-sub.o t-conv.o t-sqrt.o t-muldiv.o t-dm2exp.c reuse.o \
  t-get_d.o
TESTS = t-add t-sub t-conv t-sqrt t-muldiv t-dm2exp reuse t-get_d

check: Makefile st-add st-sub st-conv st-sqrt st-muldiv st-dm2exp st-reuse \
  st-get_d
	@echo "The tests passed."

st-add: t-add
	./t-add
	touch $@
st-sub: t-sub
	./t-sub
	touch $@
st-conv: t-conv
	./t-conv
	touch $@
st-sqrt: t-sqrt
	./t-sqrt
	touch $@
st-muldiv: t-muldiv
	./t-muldiv
	touch $@
st-dm2exp: t-dm2exp
	./t-dm2exp
	touch $@
st-reuse: reuse
	./reuse
	touch $@
st-get_d: t-get_d
	./t-get_d
	touch $@

H = $(srcdir)/../../gmp.h $(srcdir)/../../gmp-impl.h \
 $(srcdir)/../../urandom.h ../../mpn/gmp-mparam.h

t-add: t-add.o ref.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o ref.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-sub: t-sub.o ref.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o ref.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-conv: t-conv.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-sqrt: t-sqrt.o  $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-muldiv: t-muldiv.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-dm2exp: t-dm2exp.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
reuse: reuse.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@
t-get_d: t-get_d.o $(TEST_LIBS)
	$(CC) -o tmp-$@ $@.o $(TEST_LIBS) $(CFLAGS) $(XCFLAGS)
	$(srcdir)/move-if-change tmp-$@ $@

t-add.o: $(srcdir)/t-add.c
t-sub.o: $(srcdir)/t-sub.c
t-conv.o: $(srcdir)/t-conv.c
t-sqrt.o: $(srcdir)/t-sqrt.c
t-muldiv.o: $(srcdir)/t-muldiv.c
t-dm2exp.o: $(srcdir)/t-dm2exp.c
reuse.o: $(srcdir)/reuse.c
t-get_d.o: $(srcdir)/t-get_d.c

clean mostlyclean:
	rm -f *.o st-* $(TESTS)
distclean maintainer-clean: clean
	rm -f Makefile config.status

Makefile: $(srcdir)/Makefile.in
	$(SHELL) ./config.status
